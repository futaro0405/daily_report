# 2023/09/11日報
## 取り組んだこと
- [プロを目指す人のためのRuby入門](https://www.amazon.co.jp/%E3%83%97%E3%83%AD%E3%82%92%E7%9B%AE%E6%8C%87%E3%81%99%E4%BA%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AERuby%E5%85%A5%E9%96%80-%E6%94%B9%E8%A8%822%E7%89%88-%E8%A8%80%E8%AA%9E%E4%BB%95%E6%A7%98%E3%81%8B%E3%82%89%E3%83%86%E3%82%B9%E3%83%88%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA%E3%83%BB%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E6%8A%80%E6%B3%95%E3%81%BE%E3%81%A7-Software-Design/dp/4297124378/ref=sr_1_1?crid=2KR77SEG3QJJD&keywords=%E3%83%97%E3%83%AD%E3%82%92%E7%9B%AE%E6%8C%87%E3%81%99%E4%BA%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AEruby%E5%85%A5%E9%96%80&qid=1667013521&qu=eyJxc2MiOiIxLjUwIiwicXNhIjoiMS4xNiIsInFzcCI6IjEuMzUifQ%3D%3D&sprefix=%E3%83%97%E3%83%AD%E3%82%92%2Caps%2C372&sr=8-1)を読む

## わかったこと
### メソッドの可視性
#### privateメソッド
##### クラスメソッドをprivateにしたい場合
クラスメソッドはprivateキーワードの下に定義してもprivateにならない。  
クラスメソッドをprivateにしたい場合は、`class << self`構文を使う。  
`private_class_method`でクラスメソッドの定義後に可視性を変更することもできる。

#### メソッドの可視性を変える方法
`private`キーワードは実はメソッド。  
既存のメソッド名を`private`メソッドに渡すと渡したメソッドがpriveteメソッドになる。  
引数を渡した場合はその下のメソッドの可視性は変更されない。  
Rubyのメソッド定義は式になっているため、メソッド定義が完了するとメソッド名をシンボルとして返す。  
この知識を応用し、メソッド定義と同時にそのメソッドをprivateメソッドにすることができる。  
アクセサメソッドをprivateメソッドにしたいときはprivateキーワードにゲッターメソッド、セッターメソッドを渡す。  
Ruby 3.0 からは1行でprivateなアクセサメソッドを定義できるようになった。  
#### protectedメソッド
protectedメソッドはそのメソッドを定義したクラス自身とそのサブクラスのインスタンスメソッドからレシーバーつきで呼び出せるメソッド。  
Ruby3.0からシンプルにprotectedメソッドを定義できるようになった。  
Ruby2.7以前はメソッド定義の後にprotectedメソッドに変更する。  

### 定数について
定数はクラスの外部から直接参照することも可能。  
定数をクラス外部から参照不可にする場合は、`private_constant`で定数名を指定する。  

Rubyでは「メソッド内にスコープを限定した定数」を定義することはできない。  
ゆえに、メソッド内部で定数を定義使用とするとエラーになる。  
そのため、定数の定義は必ずクラス直下、もしくはトップレベルで行う必要がある。  
Rubyの定数定義はそれ自体が値を返す。  
この仕組みを利用し、次のように配列を定数に定義しつつ、その要素も同時に定数として定義することも可能。  

定数にはリテラル以外にもメソッドや条件分岐を使った動的値も代入可能。  

#### 定数と再代入
Rubyの定数はそのままの状態では定数を変更できてしまう。  
クラスの外部からの再代入を防ぐためにはfreeze（凍結）する。  

##### 定数はミュータブルなオブジェクトに注意
再代入しなくてもミュータブルなオブジェクトであれば定数の値を変更できる。  
気づかずに定数を変更していしまう事故を防ぐために定数をfreezeすることで、破壊的な変更をできなくする。  

配列やハッシュを凍結すると、配列、ハッシュそのものへの凍結はできるが、各要素は凍結できていない。  
`map`メソッドを使用して各要素の値を凍結する。  

イミュータブルなオブジェクトはfreezeする必要がない。  

### 様々な種類の変数
ローカル変数、インスタンス変数以外に次のような変数がある。  

#### クラスインスタンス変数
インスタンス変数はクラスをインスタンス化した際に、オブジェクトごとに管理される変数。  
クラスインスタンス変数はインスタンスの作成とは無関係にクラス自身が保持しているデータ。  
クラス構文の直下、クラスメソッド内部の@で始まる変数はクラスインスタンス変数にアクセスしていることになる。  

#### クラス変数
クラスインスタンス変数はインスタントメソッド内からは参照できず、同名であってもクラス構文直下、クラスメソッドの内部ではスーパークラスとサブクラスで別々の変数として参照される。  
こうした状況下でも同一の変数として代入・参照可能な変数がクラス変数。  

#### グローバル変数
グローバル変数は`$`で変数名を始める。  
クラスの内部、外部を問わず、どこからでも代入、参照が可能。  
インスタンス変数と同様、未定義のグローバル変数を参照するとnilが返る。  

#### 組み込み変数（特殊変数）
Rubyによって用途が決められている変数。  
正規表現の実行結果を格納する`$&`、`$1`。それ以外も`$stdin`、`$*`など、$で始まる変数には組み込み変数がいくつかあるため注意が必要。  

### クラス定義やRubyの言語仕様に関する高度な話題
#### エイリアスメソッドの定義
独自クラスでもエイリアスメソッドを定義することが可能。  
先に元のメソッドを定義してからエイリアスメソッドを定義しなければエラーになる。  

#### メソッドの削除
メソッドの定義を後から削除することが可能。  

#### 入れ子になったクラス定義
クラス定義では入れ子も可能。  
クラス内部に定義したクラスは`::`を使って参照する。  
クラス名の予期せぬ衝突を防ぐ「名前空間」を作る場合に用いられる。  

#### 演算子の挙動を独自に再定義する
一見演算子を使っているようで実際はメソッドとして定義されているものがあり、それらはクラスごとに再定義できる。  

## 次やること
- [プロを目指す人のためのRuby入門](https://www.amazon.co.jp/%E3%83%97%E3%83%AD%E3%82%92%E7%9B%AE%E6%8C%87%E3%81%99%E4%BA%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AERuby%E5%85%A5%E9%96%80-%E6%94%B9%E8%A8%822%E7%89%88-%E8%A8%80%E8%AA%9E%E4%BB%95%E6%A7%98%E3%81%8B%E3%82%89%E3%83%86%E3%82%B9%E3%83%88%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA%E3%83%BB%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E6%8A%80%E6%B3%95%E3%81%BE%E3%81%A7-Software-Design/dp/4297124378/ref=sr_1_1?crid=2KR77SEG3QJJD&keywords=%E3%83%97%E3%83%AD%E3%82%92%E7%9B%AE%E6%8C%87%E3%81%99%E4%BA%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AEruby%E5%85%A5%E9%96%80&qid=1667013521&qu=eyJxc2MiOiIxLjUwIiwicXNhIjoiMS4xNiIsInFzcCI6IjEuMzUifQ%3D%3D&sprefix=%E3%83%97%E3%83%AD%E3%82%92%2Caps%2C372&sr=8-1)のつづき

## 感じたこと
メソッドの可視性からクラス内の細かな操作を学んだ。  
Ruby独自のルールが多く、他の言語と照らし合わせながら、相違点を確認しながら学習することが近道な気がする。  

## 学習時間
- TODAY: 4h
- TOTAL: 241h
