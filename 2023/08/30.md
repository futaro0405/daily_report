# 2023/08/30日報
## 取り組んだこと
- [プロを目指す人のためのRuby入門](https://www.amazon.co.jp/%E3%83%97%E3%83%AD%E3%82%92%E7%9B%AE%E6%8C%87%E3%81%99%E4%BA%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AERuby%E5%85%A5%E9%96%80-%E6%94%B9%E8%A8%822%E7%89%88-%E8%A8%80%E8%AA%9E%E4%BB%95%E6%A7%98%E3%81%8B%E3%82%89%E3%83%86%E3%82%B9%E3%83%88%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA%E3%83%BB%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E6%8A%80%E6%B3%95%E3%81%BE%E3%81%A7-Software-Design/dp/4297124378/ref=sr_1_1?crid=2KR77SEG3QJJD&keywords=%E3%83%97%E3%83%AD%E3%82%92%E7%9B%AE%E6%8C%87%E3%81%99%E4%BA%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AEruby%E5%85%A5%E9%96%80&qid=1667013521&qu=eyJxc2MiOiIxLjUwIiwicXNhIjoiMS4xNiIsInFzcCI6IjEuMzUifQ%3D%3D&sprefix=%E3%83%97%E3%83%AD%E3%82%92%2Caps%2C372&sr=8-1)を読む

## わかったこと
### 正規表現
パターンを指定して、文字列を効率的に検索・置換するためのミニ言語。  
正規表現オブジェクトはスラッシュでパターンを囲んで作成する（__正規表現リテラル__）。  
文字列と正規表現のマッチを試みる方法として`=~`を使う。  
`=~`でマッチした場合文字列中の最初にマッチした位置（0以上の数値）が返り、マッチしなければnilが返る。  
条件分岐でもよく使われる。
```
if '123-4567' =~ /\d{3}-\d{4}/
  puts 'マッチしました'
else
  puts 'マッチしませんでした'
end
```
`!~`を使うとマッチしなかったときにtrue、マッチしたときにfalseを返す、
```
'hello' !~ /\d{3}-\d{4}/ #=>true
'123-4567' !~ /\d{3}-\d{4}/ #=> false
```
### 正規表現のキャプチャ
文字列から正規表現で一部を抜き出す場合、正規表現のキャプチャ機能を利用する。  
()を使って抜き出したい部分を指定する。  
キャプチャ機能と併用して`match`メソッドを使う場合が多い。  
`match`メソッドは文字列が正規表現とマッチするとMatchDataオブジェクトが返り、マッチしない場合はnilが返るメソッドである。  
MatchDataは[]を使って正規表現の処理結果を配列と同じような方法で取得できる。  

```
text = '私の誕生日は1997年7月17日です。'
m = /(\d+) 年 (\d+) 月 (\d+) 日 /.match(text)

# マッチした部分全体を取得する
m[0] #=> "1997年7月17日"

# キャプチャの1番目を取得する
m[1] #=> "1997"

# キャプチャの2番目から2個取得する
m[2, 2] #=> ["7", "17"]

# 最後のキャプチャを取得する
m[-1] #=> "17"

# Rangeを使って取得する
m[1..3] #=> ["1997", "7", "17"]
```
### キャプチャに名前をつける
キャプチャには`(?<name>)`というメタ文字を使って名前を付けることができる。  

```
text = '私の誕生日は1997年7月17日です。'
m = /(?<year>\d+)年(?<month>\d+)月(?<day>\d+)日 /.match(text)

# シンボルで名前を指定してキャプチャの結果を取得する
m[:year] #=>1997
m[:month] #=>7
m[:day] #=>17

# 文字列で指定も可能
m['year'] #=>1997
```

左辺に文字列を置き、`=~`演算子を使うことでキャプチャの名前がそのままローカル変数に割り当てられる。  
ただし、右辺と左辺を逆にすると機能しない。また、正規表現オブジェクトを一旦変数に入れた場合も同様に機能しない。  
```
text = '私の誕生日は1997年7月17日です。'
if /(?<year>\d+)年(?<month>\d+)月(?<day>\d+)日 /.match(text) =~ text
  puts "#{year}/#{month}/#{day}"
end
# => "1997/7/17"
```

### 組み込み変数
Rubyには`$`で始まる特殊な変数（__組み込み変数__）が存在する。

```
text = '私の誕生日は1997年7月17日です。'

text =~ /(\d+)年(\d+)月(\d+)日/

# MatchDataオブジェクトを取得する
$~
#=> #<MatchData "1997年7月17日" 1:"1997" 2:"7" 3:"17">

# マッチした部分全体を取得する
$&
#=> "1997年7月17日"

# 1番目～3番目のキャプチャを取得する
$1 #=> "1997"
$2 #=> "7"
$3 #=> "17"

# 最後のキャプチャの文字列を取得する
$+
#=> "17"
```

### 正規表現と組み合わせるStringクラスのメソッド
#### `scan`メソッド
`scan`メソッドは引数で渡した正規表現にマッチした部分を配列に入れて返す。  

```
'123 456 789'.scan(/\d+/)
# => ["123","456","789"]
```

正規表現に()があると、キャプチャされた部分が配列になって返ってくる。

```
'1997年7月17日 2022年12月31日'.scan(/(\d+)年(\d+)月(\d+)日/)
# => [["1997","7","17"],["2021","12","31"]]
```

グループ化したいがキャプチャはしたくない（マッチした文字列全体を取得したい）場合は、`(?:)`というメタ文字を使う。

```
'1997年7月17日 2022年12月31日'.scan(/(?:\d+)年(?:\d+)月(?:\d+)日/)
# => ["1997年7月17日","2021年12月31日"]

# 説明のためにやったが以下の記述が簡潔な正規表現
'1997年7月17日 2022年12月31日'.scan(/\d+ 年 \d+ 月 \d+ 日 /)
# => ["1997年7月17日","2021年12月31日"]
```

#### `[]`,`slice`,`slice!`
`[]`に正規表現を渡すと、文字列から正規表現にマッチした部分を抜き出す。
マッチした部分が複数ある場合は、最初にマッチした文字列が返る。

```
text = '郵便番号は123-4567です'
text[/\d{3}-\d{4}/] #=> "123-4567"
```

キャプチャを使うと第2引数で何番目のキャプチャを取得するかを指定できる。

```
text = '誕生日は1997年7月17日です'

# 第2引数がないとマッチした部分全体が返る
text[/\d+ 年 \d+ 月 \d+ 日 /] #=> "1997年7月17日"

# 第2引数を指定して3番目のキャプチャをを取得する
text[/(\d+) 年 (\d+) 月 (\d+) 日 /, 3] #=> "17"
```

名前付きキャプチャであれば名前で指定することもできる。

```
# シンボルでキャプチャの名前を指定
text[/(?<yaer>\d+) 年 (?<month>\d+) 月 (?<day>\d+) 日 /, :day] #=> "17"

# 文字列でキャプチャの名前を指定
text[/(?<yaer>\d+) 年 (?<month>\d+) 月 (?<day>\d+) 日 /, 'day'] #=> "17"
```

`slice`メソッドは`[]`のエイリアスメソッド。

```
text = '郵便番号は123-4567です'
text.slice(/\d{3}-\d{4}/) #=> "123-4567"
```

`slice!`メソッドを使用するとマッチした部分が文字列から破壊的に取り除かれる。

```
text = '郵便番号は123-4567です'
text.slice!(/\d{3}-\d{4}/) #=> "123-4567"
text # => '郵便番号はです'
```

## `split`メソッド
`split`メソッドに正規表現を渡すと、マッチした文字列を区切り文字にして文字列を分解し、配列として返す。

```
text = '123,456-789'

# 文字列で区切り文字を指定する
text.split(',') #=> ["123","456-789"]

# 正規表現を使ってカンマまたはハイフンを区切り文字に指定する
text.split(/,|-/) #=> ["123","456","789"]
```

## `gsub`メソッド,`gsub!`メソッド
`gsub`メソッドを使うと、第1引数の正規表現にマッチした文字列を第2引数の文字列で置換する。

```
text = '123,456-789'

# 第1引数に文字列を渡すと文字列を渡すと完全一致する文字列を第2引数で置き換える
text.gsub(',',':') #=> "123:456-789"

# 正規表現を渡すと、マッチした部分を第2引数で置き換える
text.gsub(/,|-/, ':') #=> "123:456:789"
```

第2引数にハッシュを渡して変換のルールを指定することもできる。

```
text = '123,456-789'

hash = {','=>':','-'=>'/'}
text.gsub(/,|-/, hash) #=> "123:456/789"
```

第2引数を渡す代わりにブロックの戻り値で置き換える文字列を指定することも可能です。

```
text = '123,456-789'

# カンマはコロンに、それ以外はスラッシュに
text.gsub(/,|-/){|matched| matched==','?':' : '/'} #=> "123:456/789"
```

`gsub!`メソッドは文字列の内容を破壊的に置換する。

```
text = '123,456-789'
text.gsub!(/,|-/, ':')
text #=> "123:456:789"
```

`gsub`メソッドや`gsub!`メソッドはキャプチャと組み合わせて文字列を置換することができる。  
キャプチャを使う場合は第2引数に文字列で指定する方法と、ブロックと組み込み文字を使う方法の2種類ある。  
第2引数に文字列で指定する場合は`\1`や`\2`のようにしてキャプチャした文字列を連番で参照できる。  
（このとき、有効な連番は`\1`から`\9`まで。）

```
text = '誕生日は1997年7月17日です'
text.gsub(/(\d+) 年 (\d+) 月 (\d+) 日 /, '\1-\2-\3')
# => "誕生日は 1997-7-17 です"
```

ただし、`\1`や`\2`を第2引数に指定する場合は、文字列をシングルクオートで囲むか、ダブルクオートで囲むかで書き方が変わるため注意が必要。

```
# ダブルクオートで囲む場合は、\\1のようにバックスラッシュを2つ重ねる
text.gsub(/(\d+) 年 (\d+) 月 (\d+) 日 /, "\\1-\\2-\\3")
```

バックスラッシュをエスケープしようとすると第2引数に指定する文字列がかなり複雑化する。  
この問題を避けるために`gsub`メソッド、`gsub!`メソッドでは第2引数の代わりにブロックを使って文字列を置換する。  
ブロックの内部では組み込み変数を使ってキャプチャした文字列を参照できる。ブロックの戻り値が置換後の文字列になる。  

```
text.gsub(/ (\d+) 年 (\d+) 月 (\d+) 日 /) do
  "#{$1}-#{$2}-{$3}"
end
# => "誕生日は1997-7-17です"
```

名前つきキャプチャを使う場合も第2引数に文字列で指定する方法とブロックを使う方法の2種類がある。  
文字列で指定する場合は`\k<name>`(ダブルクオートで囲む場合は`\\k<name>`)のようにして参照する。  

```
text = '誕生日は1997年7月17日です'
text.gsub(/(?<year>\d+) 年 (?<month>\d+) 月 (?<day>\d+) 日/ , '\k<year>-\k<month>-\k<day>')
# => "誕生日は1997-7-17です"
```

ブロックを使う場合は`$~`でMatchDataオブジェクトが参照できるため、キャプチャした文字列は`$~[:name]`のようにして参照する。

```
text.gsub(/(?<year>\d+) 年 (?<month>\d+) 月 (?<day>\d+) 日/) do
  "#{$~[:year]}-#{$~[:month]}-#{$~[:day]}"
end
# => "誕生日は1997-7-17です"
```

## 次やること
- [プロを目指す人のためのRuby入門](https://www.amazon.co.jp/%E3%83%97%E3%83%AD%E3%82%92%E7%9B%AE%E6%8C%87%E3%81%99%E4%BA%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AERuby%E5%85%A5%E9%96%80-%E6%94%B9%E8%A8%822%E7%89%88-%E8%A8%80%E8%AA%9E%E4%BB%95%E6%A7%98%E3%81%8B%E3%82%89%E3%83%86%E3%82%B9%E3%83%88%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA%E3%83%BB%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E6%8A%80%E6%B3%95%E3%81%BE%E3%81%A7-Software-Design/dp/4297124378/ref=sr_1_1?crid=2KR77SEG3QJJD&keywords=%E3%83%97%E3%83%AD%E3%82%92%E7%9B%AE%E6%8C%87%E3%81%99%E4%BA%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AEruby%E5%85%A5%E9%96%80&qid=1667013521&qu=eyJxc2MiOiIxLjUwIiwicXNhIjoiMS4xNiIsInFzcCI6IjEuMzUifQ%3D%3D&sprefix=%E3%83%97%E3%83%AD%E3%82%92%2Caps%2C372&sr=8-1)のつづき

## 感じたこと
正規表現はRubyだけでなく、他言語でも活躍するミニ言語でVSCodeの検索機能などでも応用が効く。  
積極的に学び理解の幅を広げたい。  

## 学習時間
- TODAY: 3h
- TOTAL: 233h
